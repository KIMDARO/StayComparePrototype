<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StayCompare Lite</title>

  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#f6f7fb; }
    header { background:white; padding:16px 20px; border-bottom:1px solid #e6e8ef; }
    header h1 { margin:0; font-size:18px; }
    main { max-width:1000px; margin:auto; padding:16px; }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
    .card { background:white; border:1px solid #e6e8ef; border-radius:12px; padding:14px; }
    label { font-size:12px; margin-top:10px; display:block; }
    input, textarea, select {
      width:100%; padding:10px; margin-top:6px;
      border:1px solid #cfd5e3; border-radius:10px;
    }
    textarea { resize:vertical; }
    .row { display:flex; gap:10px; }
    .row > div { flex:1; }
    button {
      background:#2b59ff; color:white; border:0;
      padding:10px 12px; border-radius:10px;
      cursor:pointer; font-weight:600;
    }
    button.secondary { background:#eef1ff; color:#1b2a7a; }
    button.danger { background:#ff2b2b; }
    button.ghost { background:transparent; border:1px solid #cfd5e3; color:#2b59ff; }
    .list { display:flex; flex-direction:column; gap:10px; margin-top:12px; }
    .stay {
      display:grid; grid-template-columns:1fr auto;
      gap:10px; padding:12px;
      border:1px solid #e6e8ef; border-radius:12px;
    }
    .muted { font-size:12px; color:#555; margin-top:4px; }
    .price { font-weight:800; font-size:16px; }
    .right { display:flex; gap:8px; }
    .pill {
      font-size:12px; padding:4px 8px;
      border-radius:999px; background:#eef1ff;
      color:#1b2a7a; margin-left:6px;
    }
    a { color:#2b59ff; text-decoration:none; }
    a:hover { text-decoration:underline; }
    footer { text-align:center; font-size:12px; color:#666; padding:20px; }
    @media(max-width:800px){ .grid{grid-template-columns:1fr;} }

    @media print {
      header, .no-print { display:none; }
      body { background:white; }
    }
  </style>
</head>

<body>
<header>
  <h1>StayCompare Lite</h1>
  <div class="muted">Add options • Compare total cost • Shortlist • Print to PDF</div>
</header>

<main>
  <div class="grid">
    <!-- FORM -->
    <section class="card">
      <h2>Add a stay</h2>

      <form id="stayForm" class="no-print">
        <label>Stay name</label>
        <input id="name" required>

        <label>Location</label>
        <input id="location">

        <div class="row">
          <div>
            <label>Nightly rate (£)</label>
            <input id="nightlyRate" type="number" required>
          </div>
          <div>
            <label>Nights</label>
            <input id="nights" type="number" required>
          </div>
        </div>

        <label>Fees (£)</label>
        <input id="fees" type="number" value="0">

        <label>Link</label>
        <input id="link" type="url">

        <label>Notes</label>
        <textarea id="notes"></textarea>

        <div style="margin-top:12px;">
          <button type="submit">Add stay</button>
          <button type="button" id="clearAll" class="secondary">Clear all</button>
        </div>
      </form>
    </section>

    <!-- LIST -->
    <section class="card">
      <div class="no-print">
        <select id="sortBy">
          <option value="cheap">Cheapest total</option>
          <option value="expensive">Most expensive</option>
          <option value="name">Name A–Z</option>
        </select>

        <button id="printBtn" class="ghost">Print / Save as PDF</button>
      </div>

      <div id="list" class="list"></div>
    </section>
  </div>

  <footer class="no-print">
    Built with HTML/CSS/JS • Uses LocalStorage
  </footer>
</main>

<script>
const LS_KEY = "staycompare_stays";
let stays = JSON.parse(localStorage.getItem(LS_KEY)) || [];

function save() {
  localStorage.setItem(LS_KEY, JSON.stringify(stays));
}

function money(n){ return "£" + Number(n).toFixed(2); }

function escapeHtml(str){
  return String(str||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}

function render(){
  const list = document.getElementById("list");
  list.innerHTML = "";

  const sort = document.getElementById("sortBy").value;
  if(sort==="cheap") stays.sort((a,b)=>a.total-b.total);
  if(sort==="expensive") stays.sort((a,b)=>b.total-a.total);
  if(sort==="name") stays.sort((a,b)=>a.name.localeCompare(b.name));

  stays.forEach(stay=>{
    const q = encodeURIComponent(`${stay.name} ${stay.location}`);
    const div = document.createElement("div");
    div.className="stay";

    div.innerHTML = `
      <div>
        <h3>${escapeHtml(stay.name)}
        ${stay.fav?'<span class="pill">Shortlisted</span>':''}</h3>

        <div class="muted">${escapeHtml(stay.location)}</div>
        <div class="price">${money(stay.total)}</div>

        ${stay.link?`<div class="muted"><a href="${stay.link}" target="_blank">Open link</a></div>`:""}
        <div class="muted">
          <a href="https://www.google.com/search?q=${q}" target="_blank">
            Search this place
          </a>
        </div>

        ${stay.notes?`<div class="muted">${escapeHtml(stay.notes)}</div>`:""}
      </div>

      <div class="right no-print">
        <button class="secondary" onclick="toggleFav('${stay.id}')">
          ${stay.fav?"Unshortlist":"Shortlist"}
        </button>
        <button class="danger" onclick="del('${stay.id}')">Delete</button>
      </div>
    `;
    list.appendChild(div);
  });
}

function toggleFav(id){
  const s = stays.find(x=>x.id===id);
  s.fav=!s.fav;
  save(); render();
}

function del(id){
  stays = stays.filter(s=>s.id!==id);
  save(); render();
}

document.getElementById("stayForm").onsubmit=e=>{
  e.preventDefault();
  const rate = +nightlyRate.value;
  const nights = +nights.value;

  stays.push({
    id:Date.now().toString(),
    name:name.value,
    location:location.value,
    total:rate*nights + (+fees.value||0),
    link:link.value,
    notes:notes.value,
    fav:false
  });

  save();
  e.target.reset();
  fees.value=0;
  render();
};

document.getElementById("clearAll").onclick=()=>{
  if(confirm("Clear all?")){ stays=[]; save(); render(); }
};

document.getElementById("sortBy").onchange=render;
document.getElementById("printBtn").onclick=()=>window.print();

render();
</script>
</body>
</html>
